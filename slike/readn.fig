#FIG 3.2
Landscape
Center
Metric
A4      
100.00
Single
-2
1200 2
6 450 900 7875 10350
6 675 1125 6075 10125
4 0 0 50 0 12 12 0.0000 4 180 735 675 1350 read_rv\001
4 0 0 50 0 12 12 0.0000 4 135 525 675 1560 readn\001
4 0 0 50 0 12 12 0.0000 4 165 315 675 1770   (\001
4 0 0 50 0 12 12 0.0000 4 150 1995 675 1980    int    const fd,\001
4 0 0 50 0 12 12 0.0000 4 180 2205 675 2190    void * const vptr,\001
4 0 0 50 0 12 12 0.0000 4 180 1785 675 2400    size_t const n\001
4 0 0 50 0 12 12 0.0000 4 165 315 675 2610   )\001
4 0 0 50 0 12 12 0.0000 4 180 1995 675 2820    throw(Exception)\001
4 0 0 50 0 12 12 0.0000 4 180 1785 675 3030 {  size_t  nleft;\001
4 0 0 50 0 12 12 0.0000 4 180 1785 675 3240    ssize_t nread;\001
4 0 0 50 0 12 12 0.0000 4 180 1575 675 3450    char *  ptr;\001
4 0 0 50 0 12 12 0.0000 4 180 2625 675 3870    ptr   = (char *) vptr;\001
4 0 0 50 0 12 12 0.0000 4 150 1365 675 4080    nleft = n;\001
4 0 0 50 0 12 12 0.0000 4 165 1995 675 4290    while(nleft > 0)\001
4 0 0 50 0 12 12 0.0000 4 150 630 675 4500      {\001
4 0 0 50 0 12 12 0.0000 4 180 4830 675 4710         if((nread = read(fd, ptr, nleft)) < 0)\001
4 0 0 50 0 12 12 0.0000 4 150 1155 675 4920           {\001
4 0 0 50 0 12 12 0.0000 4 165 3255 675 5130              if(errno == EINTR)\001
4 0 0 50 0 12 12 0.0000 4 150 2940 675 5340                   nread = 0;\001
4 0 0 50 0 12 12 0.0000 4 165 3885 675 5550              else if(errno == EAGAIN)\001
4 0 0 50 0 12 12 0.0000 4 150 1680 675 5760                {\001
4 0 0 50 0 12 12 0.0000 4 165 3360 675 5970                   if(nleft == n)\001
4 0 0 50 0 12 12 0.0000 4 165 3990 675 6180                        return no_msgs;\001
4 0 0 50 0 12 12 0.0000 4 135 2310 675 6390                   else\001
4 0 0 50 0 12 12 0.0000 4 150 2205 675 6600                     {\001
4 0 0 50 0 12 12 0.0000 4 150 3465 675 6810                        nread = 0;\001
4 0 0 50 0 12 12 0.0000 4 180 3465 675 7020                        usleep(1);\001
4 0 0 50 0 12 12 0.0000 4 150 2205 675 7230                     }\001
4 0 0 50 0 12 12 0.0000 4 150 1680 675 7440                }\001
4 0 0 50 0 12 12 0.0000 4 135 1785 675 7650              else\001
4 0 0 50 0 12 12 0.0000 4 180 5250 675 7860                   throw Exception(TXT_EXCPT_READ);\001
4 0 0 50 0 12 12 0.0000 4 150 1155 675 8070           }\001
4 0 0 50 0 12 12 0.0000 4 165 2835 675 8280         else if(nread == 0)\001
4 0 0 50 0 12 12 0.0000 4 180 5145 675 8490              return conn_dstrr;         /* EOF */\001
4 0 0 50 0 12 12 0.0000 4 150 2415 675 8910         nleft -= nread;\001
4 0 0 50 0 12 12 0.0000 4 180 2415 675 9120         ptr   += nread;\001
4 0 0 50 0 12 12 0.0000 4 150 630 675 9330      }\001
4 0 0 50 0 12 12 0.0000 4 180 1890 675 9750    return read_OK;\001
4 0 0 50 0 12 12 0.0000 4 150 105 675 9960 }\001
-6
2 2 0 1 0 7 50 0 -1 0.000 0 0 -1 0 0 5
	 450 900 7875 900 7875 10350 450 10350 450 900
-6
